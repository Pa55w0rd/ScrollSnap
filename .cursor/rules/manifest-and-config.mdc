---
globs: manifest.json,_locales/**/*.json
---

# Manifest 和配置文件规范

## Manifest V3 规范

### 必需字段
参考 [manifest.json](mdc:manifest.json)：
- `manifest_version`: 必须是 3
- `name`: 使用本地化字符串（`__MSG_extName__`）
- `version`: 语义化版本号（major.minor.patch）
- `description`: 简洁的功能描述

### 权限声明
当前使用的权限：
- `activeTab`: 访问当前活动标签页
- `downloads`: 下载截图文件
- `storage`: 存储用户设置

### Service Worker
```json
{
  "background": {
    "service_worker": "src/background.js"
  }
}
```
- Manifest V3 使用 service_worker 替代 scripts
- Service Worker 环境没有 DOM 访问
- 可能被浏览器随时终止和重启

### Content Scripts
```json
{
  "content_scripts": [{
    "js": ["src/lib/html2canvas.min.js", "src/content.js"],
    "matches": ["<all_urls>"],
    "run_at": "document_idle"
  }]
}
```
- 注入顺序很重要（依赖库必须先加载）
- `document_idle` 确保 DOM 完全加载
- `matches` 控制脚本注入的页面

### 图标规范
必须提供三种尺寸：
- 16x16: 扩展管理页面
- 48x48: 扩展管理页面
- 128x128: Chrome Web Store

## 本地化消息

在 [_locales/zh_CN/messages.json](mdc:_locales/zh_CN/messages.json) 中定义：

### 消息格式
```json
{
  "messageName": {
    "message": "显示的文本",
    "description": "消息说明（开发者使用）"
  }
}
```

### 访问方式
- Manifest 中：`__MSG_messageName__`
- JavaScript 中：`chrome.i18n.getMessage('messageName')`
- HTML 中：通过 `data-i18n` 属性和脚本加载

### 支持多语言
- 创建不同语言文件夹（如 `_locales/en/`）
- `default_locale` 指定默认语言
- 浏览器自动选择匹配的语言
